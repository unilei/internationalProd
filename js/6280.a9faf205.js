"use strict";(self["webpackChunkeslweb"]=self["webpackChunkeslweb"]||[]).push([[6280],{3515:function(e,t,s){s.d(t,{Z:function(){return S}});var o=s(6252),a=s(6612);const i={class:"menu-btn-container"},n=(0,o.Uk)("Menu"),l={key:0,class:"profile-l-container"},c={class:"l-container"},r=["Key"],d={key:0,class:"item-head_unread"};function u(e,t,s,u,h,m){const g=(0,o.up)("el-button"),p=(0,o.up)("el-image"),y=(0,o.up)("router-link"),v=(0,o.up)("el-scrollbar");return(0,o.wg)(),(0,o.j4)(v,{class:"menu-xll-bg-container"},{default:(0,o.w5)((()=>[(0,o._)("div",i,[(0,o.Wm)(g,{class:"menu-btn",type:"primary",onClick:t[0]||(t[0]=e=>m.showSideMenu())},{default:(0,o.w5)((()=>[n])),_:1})]),h.showSideMenuStatus?((0,o.wg)(),(0,o.iD)("div",l,[(0,o._)("div",c,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(m.menuData,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{class:"l-item l-item-margin",Key:t},[(0,o.Wm)(y,{class:(0,a.C_)(u.selectedKeys===e.link?"router-link-exact-active":""),to:{path:e.link},exact:""},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"xll-icon-image",src:e.icon},null,8,["src"]),(0,o._)("span",null,(0,a.zw)(e.menu_name_en),1)])),_:2},1032,["class","to"]),"MESSAGES"===e.menu_name_en&&m.unreadTotal>0?((0,o.wg)(),(0,o.iD)("div",d,(0,a.zw)(m.unreadTotal),1)):(0,o.kq)("",!0)],8,r)))),256))])])):(0,o.kq)("",!0)])),_:1})}var h=s(1474),m=s(1836),g=s(5323),p=s(3907),y=s(8339),v=s(2931),w={name:"meSideMenu",setup(){const e=(0,p.oR)(),t=t=>e.commit("nowChatUserInfo",t),s=()=>e.commit("showChatStatus",!0),a=(0,y.yj)(),i=a.meta.activeMenu,n=(0,v.iH)(i||a.path),l=(0,o.Fl)((()=>e.state.currentUser));return{setNowChatUserInfo:t,setShowChatStatus:s,selectedKeys:n,currentUser:l}},data(){return{defaultAvatar:g,accountInfo:{},accountPhotoValue:"",versionTime:(0,h.O1)(),activeMsg:!1,showSideMenuStatus:!0}},watch:{menuData(e){console.log(e)},unreadTotal(e){console.log(e)}},computed:{username:{get(){return this.$store.state.username}},userAvatar:{get(){return this.$store.state.userAvatar}},identity:{get(){return this.$store.state.identity}},menuData:{get(){return this.$store.state.menuData}},unreadTotal:{get(){return this.$store.state.imUnreadTotal}}},mounted(){let e=document.body.clientWidth;Math.floor(e)<768&&(this.showSideMenuStatus=!1),Math.floor(e)>=768&&Math.floor(e)<992&&(this.showSideMenuStatus=!0),Math.floor(e)>=992&&Math.floor(e)<1200&&(this.showSideMenuStatus=!0),Math.floor(e)>=1200&&(this.showSideMenuStatus=!0),window.onresize=()=>{let e=document.body.clientWidth;Math.floor(e)<768&&(this.showSideMenuStatus=!1),Math.floor(e)>=768&&Math.floor(e)<992&&(this.showSideMenuStatus=!0),Math.floor(e)>=992&&Math.floor(e)<1200&&(this.showSideMenuStatus=!0),Math.floor(e)>=1200&&(this.showSideMenuStatus=!0)}},methods:{showSideMenu(){this.showSideMenuStatus=!this.showSideMenuStatus},getUserMenuList(){let e=this,t={user_id:localStorage.getItem("uid"),identity:e.identity,company_id:localStorage.getItem("company_id"),create_user_id:localStorage.getItem("c_uid"),page:1,limit:1e3};(0,m.$Z)(t).then((t=>{if(200===t.code){let s=t.message.pc,o=s.filter((t=>t.identity==e.identity));this.$store.commit("menuData",o)}})).catch((e=>{console.log(e)}))},turnMyMessages(){this.setShowChatStatus()}}},f=s(8118);const _=(0,f.Z)(w,[["render",u],["__scopeId","data-v-f4e9da0c"]]);var S=_},9565:function(e,t,s){s.r(t),s.d(t,{default:function(){return He}});var o=s(6252);const a={class:"send-box"},i={class:"send-box-l"},n={class:"send-box-m"},l={class:"send-box-r"},c=(0,o.Uk)("Send");function r(e,t,s,r,d,u){const h=(0,o.up)("Folder"),m=(0,o.up)("el-icon"),g=(0,o.up)("el-input"),p=(0,o.up)("el-button");return(0,o.wg)(),(0,o.iD)("div",a,[(0,o._)("div",i,[(0,o._)("div",{class:"send-box-item",onChange:t[1]||(t[1]=(...e)=>u.chooseFile&&u.chooseFile(...e))},[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h)])),_:1}),(0,o._)("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>u.chooseFile&&u.chooseFile(...e)),class:"img-input",ref:"fileInput"},null,544)],32)]),(0,o._)("div",n,[(0,o.Wm)(g,{class:"message-input",type:"textarea",rows:1,placeholder:"Type your message here",onFocus:u.messageInputFocusin,modelValue:d.content,"onUpdate:modelValue":t[2]||(t[2]=e=>d.content=e)},null,8,["onFocus","modelValue"])]),(0,o._)("div",l,[(0,o.Wm)(p,{class:"send-btn",link:"",round:"",onClick:u.sendTextMessage},{default:(0,o.w5)((()=>[c])),_:1},8,["onClick"])])])}var d={name:"SendBox",props:["to","type"],components:{},setup(){},data(){let e="https://imgcache.qq.com/open/qcloud/tim/assets/emoji/",t={"[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png"};return{audio:{recording:!1,visible:!1},emoji:{url:e,map:t,show:!1},more:{show:!1},content:""}},methods:{onRecordComplete(e){let t=this.goEasy.im.createAudioMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity,companyId:this.to.companyId}},file:e,onProgress:function(e){console.log(e)}});this.sendMessage(t),this.$emit("onSent")},chooseImage(e){let t=e.target.files[0],s=this.goEasy.im.createImageMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity,companyId:this.to.companyId}},file:t,onProgress:function(e){console.log(e)}});this.sendMessage(s),this.$emit("onSent")},chooseVideo(e){let t=e.target.files[0],s=this.goEasy.im.createVideoMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity,companyId:this.to.companyId}},file:t,onProgress:function(e){console.log(e)}});this.sendMessage(s),this.$emit("onSent")},chooseFile(e){let t=e.target.files[0],s=this.goEasy.im.createFileMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity,companyId:this.to.companyId}},file:t,onProgress:function(e){console.log(e)}});this.sendMessage(s),this.$emit("onSent")},sendTextMessage(){if(console.log(this.to),console.log(this.type),0!==this.content.trim().length){let e=this.goEasy.im.createTextMessage({text:this.content,to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity,companyId:this.to.companyId}}});this.sendMessage(e),this.content=""}},sendMessage(e){let t=this,s=this.to.uuid,o="private"===this.type?this.service.getPrivateMessages(s):this.service.getGroupMessages(s);o.push(e),this.goEasy.im.sendMessage({message:e,onSuccess:function(e){console.log("发送成功.",e),t.$emit("onSent",o)},onFailed:function(e){console.log(e.response),console.log("发送失败:",e)}})},showCustomMessageForm(){this.$router.push({name:"customMessage",query:{to:JSON.stringify(this.to),type:this.type}})},messageInputFocusin(){this.more.show=!1,this.emoji.show=!1},showEmoji(){this.emoji.show=!this.emoji.show,this.more.show=!1},selectEmoji(e){this.content+=e},showMore(){this.more.show=!this.more.show,this.emoji.show=!1}}},u=s(8118);const h=(0,u.Z)(d,[["render",r],["__scopeId","data-v-b154204e"]]);var m=h,g=s(6612);const p={ref:"audioPlayer"};function y(e,t,s,a,i,n){return(0,o.wg)(),(0,o.iD)("div",{class:"goeasy-audio-player",onClick:t[0]||(t[0]=(...e)=>n.playAudio&&n.playAudio(...e))},[(0,o._)("div",{class:"audio-facade",style:(0,g.j5)({width:7*Math.ceil(s.duration)+80+"px"})},[(0,o._)("div",{class:(0,g.C_)(["audio-facade-bg",{"play-icon":i.play}])},null,2),(0,o._)("div",null,(0,g.zw)(Math.ceil(s.duration)||0)+'"',1)],4),(0,o._)("audio",p,null,512)])}var v={name:"GoEasyAudioPlayer",props:["src","duration"],data(){return{play:!1}},methods:{playAudio(){this.play=!0,this.$refs.audioPlayer.src=this.src,this.$refs.audioPlayer.load(),this.$refs.audioPlayer.currentTime=0,this.$refs.audioPlayer.play(),setTimeout((()=>{this.play=!1}),1e3*this.duration)}}};const w=(0,u.Z)(v,[["render",y],["__scopeId","data-v-02aa534b"]]);var f=w,_=s(8061);const S=e=>((0,o.dD)("data-v-d14a7df0"),e=e(),(0,o.Cn)(),e),M={class:"goeays-video-player"},k=["src"],I=S((()=>(0,o._)("div",{class:"icon"},null,-1))),C=["src"];function E(e,t,s,a,i,n){return(0,o.wg)(),(0,o.iD)("div",M,[s.showSnapshot?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"video-snapshot",onClick:t[1]||(t[1]=(...e)=>n.callFullScreen&&n.callFullScreen(...e))},[(0,o._)("img",{src:s.thumbnail.url,onLoad:t[0]||(t[0]=(...e)=>n.onLoadEnd&&n.onLoadEnd(...e))},null,40,k),I])):(0,o.kq)("",!0),(0,o.wy)((0,o._)("video",{ref:"goEasyVideoPlayer",class:"video-player",controls:"",src:s.video.url},null,8,C),[[_.F8,i.show]])])}var b={name:"GoEasyVideoPlayer",props:{video:{type:Object},showSnapshot:{type:Boolean,default:!0},thumbnail:{type:Object}},data(){return{show:!1}},methods:{callFullScreen(){this.show=!0;let e=this,t=this.$refs.goEasyVideoPlayer,s=t.requestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen;function o(){t.played&&!document.webkitIsFullScreen&&(t.pause(),e.show=!1,t.removeEventListener("fullscreenchange",o))}t.play(),s&&s.call(t),t.addEventListener("fullscreenchange",o)},onLoadEnd(){this.$emit("onLoadEnd")}}};const D=(0,u.Z)(b,[["render",E],["__scopeId","data-v-d14a7df0"]]);var F=D;const T={class:"chat-message"},x={key:0,class:"pending"},j={key:1,class:"send-fail"},P=["innerHTML"],A={key:3,class:"image-content"},U={key:4,class:"file-content"},$={class:"description"},q={class:"title"},W={class:"size"},L={key:7,class:"custom-message"},K=(0,o._)("div",{class:"title"},[(0,o._)("span",null,"自定义消息")],-1),R={class:"custom-message-item"},V={class:"custom-message-item"},z={class:"custom-message-item"};function H(e,t,s,a,i,n){const l=(0,o.up)("el-image"),c=F,r=f;return(0,o.wg)(),(0,o.iD)("div",{class:(0,g.C_)(["message-item",{self:s.message.senderId==s.currentUser.uuid}])},["group"==s.type?((0,o.wg)(),(0,o.j4)(l,{key:0,src:s.message.senderData.avatar,class:"chat-avatar"},null,8,["src"])):s.message.senderId==s.currentUser.uuid?((0,o.wg)(),(0,o.j4)(l,{key:1,src:s.currentUser.avatar,class:"chat-avatar"},null,8,["src"])):((0,o.wg)(),(0,o.j4)(l,{key:2,src:s.to.avatar,class:"chat-avatar"},null,8,["src"])),(0,o._)("div",T,["sending"==s.messageStatus?((0,o.wg)(),(0,o.iD)("div",x)):(0,o.kq)("",!0),"fail"==s.messageStatus?((0,o.wg)(),(0,o.iD)("div",j)):(0,o.kq)("",!0),"text"==s.message.type?((0,o.wg)(),(0,o.iD)("div",{key:2,class:(0,g.C_)(["text-content",s.message.senderId==s.currentUser.uuid?"":"text-content-1"]),innerHTML:i.decoder.decode(s.message.payload.text)},null,10,P)):(0,o.kq)("",!0),"image"==s.message.type?((0,o.wg)(),(0,o.iD)("div",A,[(0,o.Wm)(l,{src:s.message.payload.url,onClick:n.showImageFullScreen},null,8,["src","onClick"])])):(0,o.kq)("",!0),"file"==s.message.type?((0,o.wg)(),(0,o.iD)("div",U,[(0,o.Wm)(l,{src:"./static/file-content.png",alt:""}),(0,o._)("div",$,[(0,o._)("span",q,(0,g.zw)(s.message.payload.name),1),(0,o._)("span",W,(0,g.zw)((s.message.payload.size/1024).toFixed(2))+" KB",1)])])):(0,o.kq)("",!0),"video"==s.message.type?((0,o.wg)(),(0,o.j4)(c,{key:5,video:s.message.payload.video,thumbnail:s.message.payload.thumbnail},null,8,["video","thumbnail"])):(0,o.kq)("",!0),"audio"==s.message.type?((0,o.wg)(),(0,o.j4)(r,{key:6,src:s.message.payload.url,duration:s.message.payload.duration},null,8,["src","duration"])):(0,o.kq)("",!0),"order"==s.message.type?((0,o.wg)(),(0,o.iD)("div",L,[K,(0,o._)("div",R,"编号: "+(0,g.zw)(s.message.payload.number),1),(0,o._)("div",V,"商品: "+(0,g.zw)(s.message.payload.goods),1),(0,o._)("div",z,"金额: "+(0,g.zw)(s.message.payload.price),1)])):(0,o.kq)("",!0)])],2)}function N(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class O{constructor(e,t){N(this,"emojiMap",null),N(this,"url",""),N(this,"patterns",[]),N(this,"metaChars",/[[\]{}()*+?.\\|^$\-,&#\s]/g),this.url=e||"",this.emojiMap=t||{};for(let s in this.emojiMap)this.emojiMap.hasOwnProperty(s)&&this.patterns.push("("+s.replace(this.metaChars,"\\$&")+")")}decode(e){return e.replace(new RegExp(this.patterns.join("|"),"g"),(e=>"undefined"!=typeof this.emojiMap[e]?'<img height="20rpx" width="20rpx" src="'+this.url+this.emojiMap[e]+'" />':e))}}var G=O,B={name:"chatMessage",props:["message","to","currentUser","type","messageStatus"],components:{GoEasyAudioPlayer:f,GoEasyVideoPlayer:F},data(){let e="https://imgcache.qq.com/open/qcloud/tim/assets/emoji/",t={"[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png"};return{decoder:new G(e,t)}},methods:{showImageFullScreen(){this.$emit("showImageFullScreen",this.message)}}};const Z=(0,u.Z)(B,[["render",H]]);var Y=Z,J=s(3515);const Q=e=>((0,o.dD)("data-v-26fc0f70"),e=e(),(0,o.Cn)(),e),X={class:"bg"},ee={class:"message-container"},te={class:"message-l-container"},se={class:"message-r-container"},oe={class:"message-r-bg-container"},ae={class:"chat-content-container"},ie={class:"chat-side-container"},ne={class:"chat-side-t-container"},le=Q((()=>(0,o._)("div",{class:"chat-side-t-label"}," Messages ",-1))),ce={class:"chat-side-search"},re={class:"conversations"},de={key:0},ue={class:"item-head"},he={key:0,class:"item-head_unread"},me=["onClick"],ge={class:"item-info-top"},pe={class:"item-info-top_name"},ye={class:"item-info-bottom"},ve={class:"item-info-bottom-item"},we={class:"item-info-top_content"},fe={key:0,class:"text-conversation"},_e={key:1},Se={key:2},Me={key:3},ke={key:4},Ie={key:5},Ce={key:6},Ee={class:"item-info-bottom_action"},be={key:0,class:"item-info-bottom_action-btn"},De={class:"item-info-bottom_delete_btn"},Fe=(0,o.Uk)(" DELETE CHATS "),Te={key:1,class:"no-conversation"},xe={class:"mask"},je={class:"chat-chat-container"},Pe={class:"chat-message-container"},Ae={key:0,class:"time-lag"};function Ue(e,t,s,a,i,n){const l=J.Z,c=(0,o.up)("el-input"),r=(0,o.up)("el-image"),d=(0,o.up)("ArrowDownBold"),u=(0,o.up)("el-icon"),h=(0,o.up)("el-button"),p=(0,o.up)("el-popover"),y=(0,o.up)("el-scrollbar"),v=Y,w=m;return(0,o.wg)(),(0,o.iD)("div",X,[(0,o._)("div",ee,[(0,o._)("div",te,[(0,o.Wm)(l)]),(0,o._)("div",se,[(0,o._)("div",oe,[(0,o._)("div",ae,[(0,o._)("div",ie,[(0,o._)("div",ne,[le,(0,o._)("div",ce,[(0,o.Wm)(c,{placeholder:"Search chats"})])]),(0,o._)("div",re,[(0,o.Wm)(y,{class:"conversations-box"},{default:(0,o.w5)((()=>[0!==i.conversationsData.length?((0,o.wg)(),(0,o.iD)("div",de,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.conversationsData,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{class:(0,g.C_)(["scroll-item",i.activeConversationKey===e.userId+"_"+e.data.identity?"conversation-active":""]),key:t},[(0,o._)("div",ue,[(0,o.Wm)(r,{src:e.data.avatar,class:"head-icon"},null,8,["src"]),e.unread?((0,o.wg)(),(0,o.iD)("div",he,(0,g.zw)(e.unread),1)):(0,o.kq)("",!0)]),(0,o._)("div",{class:"scroll-item_info",onClick:t=>n.navigateToChat(e)},[(0,o._)("div",ge,[(0,o._)("span",pe,(0,g.zw)(e.data.name),1)]),(0,o._)("div",ye,[(0,o._)("div",ve,[(0,o._)("div",we,["text"==e.lastMessage.type?((0,o.wg)(),(0,o.iD)("span",fe,(0,g.zw)(e.lastMessage.payload.text),1)):"video"==e.lastMessage.type?((0,o.wg)(),(0,o.iD)("span",_e,"[Video Message]")):"audio"==e.lastMessage.type?((0,o.wg)(),(0,o.iD)("span",Se,"[Audio Message]")):"image"==e.lastMessage.type?((0,o.wg)(),(0,o.iD)("span",Me,"[Image Message]")):"file"==e.lastMessage.type?((0,o.wg)(),(0,o.iD)("span",ke,"[File Message]")):"order"==e.lastMessage.type?((0,o.wg)(),(0,o.iD)("span",Ie,"[Order Message]")):((0,o.wg)(),(0,o.iD)("span",Ce,"[Unidentified content]"))]),(0,o._)("div",Ee,[(0,o.Wm)(p,{visible:i.activeActionKey===t,placement:"bottom",width:150},{reference:(0,o.w5)((()=>[(0,o.Wm)(u,{onClick:s=>n.showAction(e,t)},{default:(0,o.w5)((()=>[(0,o.Wm)(d)])),_:2},1032,["onClick"])])),default:(0,o.w5)((()=>[i.action.show?((0,o.wg)(),(0,o.iD)("div",be,[(0,o._)("div",null,[(0,o.Wm)(h,{link:"",type:"primary",onClick:n.topConversation},{default:(0,o.w5)((()=>[(0,o.Uk)((0,g.zw)(i.action.conversation.top?"UNPIN":"PIN CHAT TO THE TOP"),1)])),_:2},1032,["onClick"])]),(0,o._)("div",De,[(0,o.Wm)(h,{link:"",type:"warning",onClick:n.removeConversation},{default:(0,o.w5)((()=>[Fe])),_:1},8,["onClick"])])])):(0,o.kq)("",!0)])),_:2},1032,["visible"])])])])],8,me)],2)))),128))])):((0,o.wg)(),(0,o.iD)("div",Te," No Chat Currently "))])),_:1}),(0,o.wy)((0,o._)("div",xe,null,512),[[_.F8,i.showLoading]])])]),(0,o._)("div",je,[(0,o._)("div",Pe,[(0,o.Wm)(y,{class:"scroll-view",ref:"scrollView"},{default:(0,o.w5)((()=>[(0,o._)("div",{class:"history-load-tip",onClick:t[0]||(t[0]=e=>n.loadMoreHistoryMessage())},(0,g.zw)(i.allHistoryLoaded?"History has no more messages":"Click to get history messages"),1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.messages,((t,s)=>((0,o.wg)(),(0,o.iD)("div",{key:s},[0==s||a.messages[s].timestamp-a.messages[s-1].timestamp>3e5?((0,o.wg)(),(0,o.iD)("div",Ae,(0,g.zw)(e.formatDate(t.timestamp)),1)):(0,o.kq)("",!0),(0,o.Wm)(v,{message:t,messageStatus:t.status,to:i.friend,currentUser:a.currentUser,type:i.type,onShowImageFullScreen:n.showImageFullScreen},null,8,["message","messageStatus","to","currentUser","type","onShowImageFullScreen"])])))),128))])),_:1},512)]),(0,o.Wm)(w,{to:i.friend,type:i.type,onOnSent:n.messageOnSent},null,8,["to","type","onOnSent"]),(0,o.wy)((0,o._)("div",{class:"img-layer",onClick:t[1]||(t[1]=e=>i.image.show=!1)},[(0,o.Wm)(r,{src:i.image.url},null,8,["src"])],512),[[_.F8,i.image.show]])])])])])])])}var $e=s(5323),qe=s(2931),We=s(6949),Le=s.p+"img/chat-icon.6be646e3.png",Ke=s.p+"img/chat-icon-1.17838274.png",Re=s(3907),Ve={name:"index",components:{meSideMenu:J.Z,SendBox:m,ChatMessage:Y},setup(){const e=(0,qe.iH)(localStorage.getItem("identity")),t=(0,o.Fl)((()=>e.value)),s=(0,Re.oR)();let a=localStorage.getItem("token");const i=(0,o.Fl)((()=>s.state.currentUser)),n=(0,o.Fl)((()=>s.state.nowChatUserInfo)),l=(0,o.Fl)((()=>s.state.showChatStatus)),c=()=>s.commit("showChatStatus",!s.state.showChatStatus),r=(0,qe.iH)([]);return{identity1:t,token:a,currentUser:i,nowChatUserInfo:n,showChatStatus:l,setShowChatStatus:c,messages:r}},watch:{},computed:{},data(){return{defaultAvatar:$e,imgLogo:We,chatIcon:Le,chatIcon1:Ke,showLoading:!1,action:{conversation:null,show:!1,toastMessage:"",showToast:!1},conversationsData:[],activeConversationKey:void 0,friendId:void 0,chatType:"",friend:null,allHistoryLoaded:!1,image:{show:!1,url:""},type:"",unreadTotal:0,showBottomActionStatus:!1,activeActionKey:void 0}},beforeMount(){let e=this;this.showLoading=!0;let t=this.currentUser;"disconnected"===this.goEasy.getConnectionStatus()&&this.service.connect(t),this.goEasy.im.latestConversations({onSuccess:function(t){console.log("加载会话列表----------- messages page");let s=t.content;e.showLoading=!1,e.$store.commit("setImUnreadTotal",s.unreadTotal),e.conversationsData=s.conversations},onFailed:function(e){this.showLoading=!1,console.log("失败获取最新会话列表, code:"+e.code+" content:"+e.content)}}),this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,(t=>{console.log("监听会话列表变化-------  messages page"),e.conversationsData=t.conversations||[],e.$store.commit("setImUnreadTotal",t.unreadTotal)}));let s=e.nowChatUserInfo;"{}"!==JSON.stringify(s)&&(console.log("now chat user info ----- "),this.type=this.GoEasy.IM_SCENE.PRIVATE,e.messages=e.service.getPrivateMessages(s.uuid),e.friend=s,e.activeConversationKey=s.uuid+"_"+s.identity,e.scrollToBottom(),e.initialPrivateListeners(),0!==e.messages.length&&e.markMessageAsRead(s.uuid))},unmounted(){this.service.onNewPrivateMessageReceive=function(){}},methods:{topConversation(){let e=this,t=this.action.conversation,s=t.top?"Cancel Failed":"Pin Failed";t.type===this.GoEasy.IM_SCENE.PRIVATE?this.goEasy.im.topPrivateConversation({userId:t.userId,top:!t.top,onSuccess:function(){console.log("pin success")},onFailed:function(t){e.$message.error(s),console.log(t)}}):this.goEasy.im.topGroupConversation({groupId:t.groupId,top:!t.top,onSuccess:function(){console.log("pin fail")},onFailed:function(t){e.$message.error(s),console.log(t)}}),this.action.show=!1,e.activeActionKey=void 0},removeConversation(){let e=this,t=this.action.conversation,s="delete failed";t.type===this.GoEasy.IM_SCENE.PRIVATE?this.goEasy.im.removePrivateConversation({userId:t.userId,onSuccess:function(){console.log("delete success")},onFailed:function(t){e.$message.error(s),console.log(t)}}):this.goEasy.im.removeGroupConversation({groupId:t.groupId,onSuccess:function(){console.log("delete failed")},onFailed:function(t){e.$message.error(s),console.log(t)}}),this.action.show=!1,e.activeActionKey=void 0},async navigateToChat(e){console.log("navigate to chat --------------------"),this.activeConversationKey=e.userId+"_"+e.data.identity;let t=e.userId||e.groupId,s=e.data.identity,o=e.data.companyId,a=t;this.type=this.GoEasy.IM_SCENE.PRIVATE,this.friend=await this.service.findFriendById(a,s,o),this.messages=this.service.getPrivateMessages(a),this.scrollToBottom(),this.initialPrivateListeners(),0!==this.messages.length&&this.markMessageAsRead(a)},showAction(e,t){this.activeActionKey===t?this.activeActionKey=void 0:this.activeActionKey=t,this.action.conversation=e,this.action.show=!0},initialPrivateListeners(){let e=this;this.service.onNewPrivateMessageReceive=(t,s)=>{console.log("传入监听器，收到一条私聊消息总是滚到到页面底部"+s);let o=this.messages;this.messages=[],this.messages=o,t===e.friend.uuid&&(e.markMessageAsRead(t),e.scrollToBottom())}},loadMoreHistoryMessage(){console.log("加载更多历史消息-----------------");let e=this,t=Date.now(),s=this.messages[0];s&&(t=s.timestamp);let o=this.messages.length;this.goEasy.im.history({userId:e.friend.uuid,lastTimestamp:t,onSuccess:function(t){let s=e.service.getPrivateMessages(e.friend.uuid),a=t.content;for(let e=a.length-1;e>=0;e--)s.unshift(a[e]);s.length===o&&(e.allHistoryLoaded=!0),e.messages=s},onFailed:function(e){401===e.code?console.log("获取历史消息失败,默认不开通，付费应用，可以在我的应用->查看详情，高级功能里自助开通"):console.log("获取历史消息失败, code:"+e.code+",错误信息:"+e.content)}})},markMessageAsRead(e){this.goEasy.im.markPrivateMessageAsRead({userId:e,onSuccess:function(){console.log("标记为已读成功")},onFailed:function(e){console.log("标记为已读失败",e)}})},showImageFullScreen(e){this.image.url=e.payload.url,this.image.show=!0},scrollToBottom(){this.$nextTick((()=>{this.$refs.scrollView.scrollTo(0,1e7)}))},messageOnSent(e){this.messages=[],this.messages=e,this.scrollToBottom(),this.$forceUpdate()}}};const ze=(0,u.Z)(Ve,[["render",Ue],["__scopeId","data-v-26fc0f70"]]);var He=ze}}]);
//# sourceMappingURL=6280.a9faf205.js.map