"use strict";(self["webpackChunkeslweb"]=self["webpackChunkeslweb"]||[]).push([[2431],{7876:function(e,t,s){s.d(t,{Z:function(){return _}});var a=s(6252),o=s(6612);const i={class:"menu-btn-container"},n=(0,a.Uk)("Menu"),l={key:0,class:"profile-l-container"},r={class:"l-container"},c=["Key"];function d(e,t,s,d,u,h){const m=(0,a.up)("el-button"),g=(0,a.up)("el-image"),p=(0,a.up)("router-link"),y=(0,a.up)("el-scrollbar");return(0,a.wg)(),(0,a.j4)(y,{class:"menu-xll-bg-container"},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a.Wm)(m,{class:"menu-btn",type:"primary",onClick:t[0]||(t[0]=e=>h.showSideMenu())},{default:(0,a.w5)((()=>[n])),_:1})]),u.showSideMenuStatus?((0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",r,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.menuData,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{class:"l-item l-item-margin",Key:t},[(0,a.Wm)(p,{class:(0,o.C_)(d.selectedKeys===e.link?"router-link-exact-active":""),to:{path:e.link},exact:""},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:"xll-icon-image",src:e.icon},null,8,["src"]),(0,a._)("span",null,(0,o.zw)(e.menu_name_en),1)])),_:2},1032,["class","to"])],8,c)))),256))])])):(0,a.kq)("",!0)])),_:1})}var u=s(1474),h=s(1836),m=s(5323),g=s(3907),p=s(8339),y=s(2931),v={name:"meSideMenu",setup(){const e=(0,g.oR)(),t=t=>e.commit("nowChatUserInfo",t),s=()=>e.commit("showChatStatus",!0),a=(0,p.yj)(),o=a.meta.activeMenu,i=(0,y.iH)(o||a.path);return{setNowChatUserInfo:t,setShowChatStatus:s,selectedKeys:i}},data(){return{defaultAvatar:m,accountInfo:{},accountPhotoValue:"",versionTime:(0,u.O1)(),activeMsg:!1,showSideMenuStatus:!0}},watch:{menuData(e){console.log(e)}},computed:{username:{get(){return this.$store.state.username}},userAvatar:{get(){return this.$store.state.userAvatar}},identity:{get(){return this.$store.state.identity}},menuData:{get(){return this.$store.state.menuData}}},mounted(){let e=document.body.clientWidth;Math.floor(e)<768&&(this.showSideMenuStatus=!1),Math.floor(e)>=768&&Math.floor(e)<992&&(this.showSideMenuStatus=!0),Math.floor(e)>=992&&Math.floor(e)<1200&&(this.showSideMenuStatus=!0),Math.floor(e)>=1200&&(this.showSideMenuStatus=!0),window.onresize=()=>{let e=document.body.clientWidth;Math.floor(e)<768&&(this.showSideMenuStatus=!1),Math.floor(e)>=768&&Math.floor(e)<992&&(this.showSideMenuStatus=!0),Math.floor(e)>=992&&Math.floor(e)<1200&&(this.showSideMenuStatus=!0),Math.floor(e)>=1200&&(this.showSideMenuStatus=!0)}},methods:{showSideMenu(){this.showSideMenuStatus=!this.showSideMenuStatus},getUserMenuList(){let e=this,t={user_id:localStorage.getItem("uid"),identity:e.identity,company_id:localStorage.getItem("company_id"),create_user_id:localStorage.getItem("c_uid"),page:1,limit:1e3};(0,h.$Z)(t).then((t=>{if(200===t.code){let s=t.message.pc,a=s.filter((t=>t.identity==e.identity));this.$store.commit("menuData",a)}})).catch((e=>{console.log(e)}))},turnMyMessages(){this.setShowChatStatus()}}},w=s(8118);const f=(0,w.Z)(v,[["render",d],["__scopeId","data-v-73c372ce"]]);var _=f},7550:function(e,t,s){s.r(t),s.d(t,{default:function(){return He}});var a=s(6252);const o={class:"send-box"},i={class:"send-box-l"},n={class:"send-box-m"},l={class:"send-box-r"},r=(0,a.Uk)("Send");function c(e,t,s,c,d,u){const h=(0,a.up)("Folder"),m=(0,a.up)("el-icon"),g=(0,a.up)("el-input"),p=(0,a.up)("el-button");return(0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("div",i,[(0,a._)("div",{class:"send-box-item",onChange:t[1]||(t[1]=(...e)=>u.chooseFile&&u.chooseFile(...e))},[(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h)])),_:1}),(0,a._)("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>u.chooseFile&&u.chooseFile(...e)),class:"img-input",ref:"fileInput"},null,544)],32)]),(0,a._)("div",n,[(0,a.Wm)(g,{class:"message-input",type:"textarea",rows:1,placeholder:"Type your message here",onFocus:u.messageInputFocusin,modelValue:d.content,"onUpdate:modelValue":t[2]||(t[2]=e=>d.content=e)},null,8,["onFocus","modelValue"])]),(0,a._)("div",l,[(0,a.Wm)(p,{class:"send-btn",link:"",round:"",onClick:u.sendTextMessage},{default:(0,a.w5)((()=>[r])),_:1},8,["onClick"])])])}var d={name:"SendBox",props:["to","type"],components:{},setup(){},data(){let e="https://imgcache.qq.com/open/qcloud/tim/assets/emoji/",t={"[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png"};return{audio:{recording:!1,visible:!1},emoji:{url:e,map:t,show:!1},more:{show:!1},content:""}},methods:{onRecordComplete(e){let t=this.goEasy.im.createAudioMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity}},file:e,onProgress:function(e){console.log(e)}});this.sendMessage(t),this.$emit("onSent")},chooseImage(e){let t=e.target.files[0],s=this.goEasy.im.createImageMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity}},file:t,onProgress:function(e){console.log(e)}});this.sendMessage(s),this.$emit("onSent")},chooseVideo(e){let t=e.target.files[0],s=this.goEasy.im.createVideoMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity}},file:t,onProgress:function(e){console.log(e)}});this.sendMessage(s),this.$emit("onSent")},chooseFile(e){let t=e.target.files[0],s=this.goEasy.im.createFileMessage({to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity}},file:t,onProgress:function(e){console.log(e)}});this.sendMessage(s),this.$emit("onSent")},sendTextMessage(){if(0!==this.content.trim().length){let e=this.goEasy.im.createTextMessage({text:this.content,to:{id:this.to.uuid,type:this.type,data:{name:this.to.name,avatar:this.to.avatar,identity:this.to.identity}}});this.sendMessage(e),this.content=""}},sendMessage(e){let t=this,s=this.to.uuid,a="private"===this.type?this.service.getPrivateMessages(s):this.service.getGroupMessages(s);a.push(e),this.goEasy.im.sendMessage({message:e,onSuccess:function(e){console.log("发送成功.",e),t.$emit("onSent",a)},onFailed:function(e){console.log("发送失败:",e)}})},showCustomMessageForm(){this.$router.push({name:"customMessage",query:{to:JSON.stringify(this.to),type:this.type}})},messageInputFocusin(){this.more.show=!1,this.emoji.show=!1},showEmoji(){this.emoji.show=!this.emoji.show,this.more.show=!1},selectEmoji(e){this.content+=e},showMore(){this.more.show=!this.more.show,this.emoji.show=!1}}},u=s(8118);const h=(0,u.Z)(d,[["render",c],["__scopeId","data-v-117d8a14"]]);var m=h,g=s(6612);const p={ref:"audioPlayer"};function y(e,t,s,o,i,n){return(0,a.wg)(),(0,a.iD)("div",{class:"goeasy-audio-player",onClick:t[0]||(t[0]=(...e)=>n.playAudio&&n.playAudio(...e))},[(0,a._)("div",{class:"audio-facade",style:(0,g.j5)({width:7*Math.ceil(s.duration)+80+"px"})},[(0,a._)("div",{class:(0,g.C_)(["audio-facade-bg",{"play-icon":i.play}])},null,2),(0,a._)("div",null,(0,g.zw)(Math.ceil(s.duration)||0)+'"',1)],4),(0,a._)("audio",p,null,512)])}var v={name:"GoEasyAudioPlayer",props:["src","duration"],data(){return{play:!1}},methods:{playAudio(){this.play=!0,this.$refs.audioPlayer.src=this.src,this.$refs.audioPlayer.load(),this.$refs.audioPlayer.currentTime=0,this.$refs.audioPlayer.play(),setTimeout((()=>{this.play=!1}),1e3*this.duration)}}};const w=(0,u.Z)(v,[["render",y],["__scopeId","data-v-02aa534b"]]);var f=w,_=s(8061);const M=e=>((0,a.dD)("data-v-d14a7df0"),e=e(),(0,a.Cn)(),e),S={class:"goeays-video-player"},k=["src"],C=M((()=>(0,a._)("div",{class:"icon"},null,-1))),I=["src"];function b(e,t,s,o,i,n){return(0,a.wg)(),(0,a.iD)("div",S,[s.showSnapshot?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"video-snapshot",onClick:t[1]||(t[1]=(...e)=>n.callFullScreen&&n.callFullScreen(...e))},[(0,a._)("img",{src:s.thumbnail.url,onLoad:t[0]||(t[0]=(...e)=>n.onLoadEnd&&n.onLoadEnd(...e))},null,40,k),C])):(0,a.kq)("",!0),(0,a.wy)((0,a._)("video",{ref:"goEasyVideoPlayer",class:"video-player",controls:"",src:s.video.url},null,8,I),[[_.F8,i.show]])])}var D={name:"GoEasyVideoPlayer",props:{video:{type:Object},showSnapshot:{type:Boolean,default:!0},thumbnail:{type:Object}},data(){return{show:!1}},methods:{callFullScreen(){this.show=!0;let e=this,t=this.$refs.goEasyVideoPlayer,s=t.requestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen;function a(){t.played&&!document.webkitIsFullScreen&&(t.pause(),e.show=!1,t.removeEventListener("fullscreenchange",a))}t.play(),s&&s.call(t),t.addEventListener("fullscreenchange",a)},onLoadEnd(){this.$emit("onLoadEnd")}}};const E=(0,u.Z)(D,[["render",b],["__scopeId","data-v-d14a7df0"]]);var F=E;const x={class:"chat-message"},j={key:0,class:"pending"},P={key:1,class:"send-fail"},T=["innerHTML"],A={key:3,class:"image-content"},$={key:4,class:"file-content"},U={class:"description"},q={class:"title"},W={class:"size"},L={key:7,class:"custom-message"},K=(0,a._)("div",{class:"title"},[(0,a._)("span",null,"自定义消息")],-1),R={class:"custom-message-item"},V={class:"custom-message-item"},z={class:"custom-message-item"};function H(e,t,s,o,i,n){const l=(0,a.up)("el-image"),r=F,c=f;return(0,a.wg)(),(0,a.iD)("div",{class:(0,g.C_)(["message-item",{self:s.message.senderId==s.currentUser.uuid}])},["group"==s.type?((0,a.wg)(),(0,a.j4)(l,{key:0,src:s.message.senderData.avatar,class:"chat-avatar"},null,8,["src"])):s.message.senderId==s.currentUser.uuid?((0,a.wg)(),(0,a.j4)(l,{key:1,src:s.currentUser.avatar,class:"chat-avatar"},null,8,["src"])):((0,a.wg)(),(0,a.j4)(l,{key:2,src:s.to.avatar,class:"chat-avatar"},null,8,["src"])),(0,a._)("div",x,["sending"==s.messageStatus?((0,a.wg)(),(0,a.iD)("div",j)):(0,a.kq)("",!0),"fail"==s.messageStatus?((0,a.wg)(),(0,a.iD)("div",P)):(0,a.kq)("",!0),"text"==s.message.type?((0,a.wg)(),(0,a.iD)("div",{key:2,class:(0,g.C_)(["text-content",s.message.senderId==s.currentUser.uuid?"":"text-content-1"]),innerHTML:i.decoder.decode(s.message.payload.text)},null,10,T)):(0,a.kq)("",!0),"image"==s.message.type?((0,a.wg)(),(0,a.iD)("div",A,[(0,a.Wm)(l,{src:s.message.payload.url,onClick:n.showImageFullScreen},null,8,["src","onClick"])])):(0,a.kq)("",!0),"file"==s.message.type?((0,a.wg)(),(0,a.iD)("div",$,[(0,a.Wm)(l,{src:"./static/file-content.png",alt:""}),(0,a._)("div",U,[(0,a._)("span",q,(0,g.zw)(s.message.payload.name),1),(0,a._)("span",W,(0,g.zw)((s.message.payload.size/1024).toFixed(2))+" KB",1)])])):(0,a.kq)("",!0),"video"==s.message.type?((0,a.wg)(),(0,a.j4)(r,{key:5,video:s.message.payload.video,thumbnail:s.message.payload.thumbnail},null,8,["video","thumbnail"])):(0,a.kq)("",!0),"audio"==s.message.type?((0,a.wg)(),(0,a.j4)(c,{key:6,src:s.message.payload.url,duration:s.message.payload.duration},null,8,["src","duration"])):(0,a.kq)("",!0),"order"==s.message.type?((0,a.wg)(),(0,a.iD)("div",L,[K,(0,a._)("div",R,"编号: "+(0,g.zw)(s.message.payload.number),1),(0,a._)("div",V,"商品: "+(0,g.zw)(s.message.payload.goods),1),(0,a._)("div",z,"金额: "+(0,g.zw)(s.message.payload.price),1)])):(0,a.kq)("",!0)])],2)}function O(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class N{constructor(e,t){O(this,"emojiMap",null),O(this,"url",""),O(this,"patterns",[]),O(this,"metaChars",/[[\]{}()*+?.\\|^$\-,&#\s]/g),this.url=e||"",this.emojiMap=t||{};for(let s in this.emojiMap)this.emojiMap.hasOwnProperty(s)&&this.patterns.push("("+s.replace(this.metaChars,"\\$&")+")")}decode(e){return e.replace(new RegExp(this.patterns.join("|"),"g"),(e=>"undefined"!=typeof this.emojiMap[e]?'<img height="20rpx" width="20rpx" src="'+this.url+this.emojiMap[e]+'" />':e))}}var B=N,G={name:"chatMessage",props:["message","to","currentUser","type","messageStatus"],components:{GoEasyAudioPlayer:f,GoEasyVideoPlayer:F},data(){let e="https://imgcache.qq.com/open/qcloud/tim/assets/emoji/",t={"[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png"};return{decoder:new B(e,t)}},methods:{showImageFullScreen(){this.$emit("showImageFullScreen",this.message)}}};const Z=(0,u.Z)(G,[["render",H]]);var Y=Z,J=s(7876);const Q=e=>((0,a.dD)("data-v-7bf96b23"),e=e(),(0,a.Cn)(),e),X={class:"bg"},ee={class:"message-container"},te={class:"message-l-container"},se={class:"message-r-container"},ae={class:"message-r-bg-container"},oe={class:"chat-content-container"},ie={class:"chat-side-container"},ne={class:"chat-side-t-container"},le=Q((()=>(0,a._)("div",{class:"chat-side-t-label"}," Messages ",-1))),re={class:"chat-side-search"},ce={class:"conversations"},de={key:0},ue={class:"item-head"},he={key:0,class:"item-head_unread"},me=["onClick"],ge={class:"item-info-top"},pe={class:"item-info-top_name"},ye={class:"item-info-bottom"},ve={class:"item-info-bottom-item"},we={class:"item-info-top_content"},fe={key:0,class:"text-conversation"},_e={key:1},Me={key:2},Se={key:3},ke={key:4},Ce={key:5},Ie={key:6},be={class:"item-info-bottom_action"},De={key:0,class:"item-info-bottom_action-btn"},Ee={class:"item-info-bottom_delete_btn"},Fe=(0,a.Uk)(" Delete Chat "),xe={key:1,class:"no-conversation"},je={class:"mask"},Pe={class:"chat-chat-container"},Te={class:"chat-message-container"},Ae={key:0,class:"time-lag"};function $e(e,t,s,o,i,n){const l=J.Z,r=(0,a.up)("el-input"),c=(0,a.up)("el-image"),d=(0,a.up)("more-filled"),u=(0,a.up)("el-icon"),h=(0,a.up)("el-button"),p=(0,a.up)("el-popover"),y=(0,a.up)("el-scrollbar"),v=Y,w=m;return(0,a.wg)(),(0,a.iD)("div",X,[(0,a._)("div",ee,[(0,a._)("div",te,[(0,a.Wm)(l)]),(0,a._)("div",se,[(0,a._)("div",ae,[(0,a._)("div",oe,[(0,a._)("div",ie,[(0,a._)("div",ne,[le,(0,a._)("div",re,[(0,a.Wm)(r,{placeholder:"Search chats"})])]),(0,a._)("div",ce,[(0,a.Wm)(y,{class:"conversations-box"},{default:(0,a.w5)((()=>[0!==i.conversationsData.length?((0,a.wg)(),(0,a.iD)("div",de,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.conversationsData,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{class:(0,g.C_)(["scroll-item",i.activeConversationKey===e.userId+"_"+e.data.identity?"conversation-active":""]),key:t},[(0,a._)("div",ue,[(0,a.Wm)(c,{src:e.data.avatar,class:"head-icon"},null,8,["src"]),e.unread?((0,a.wg)(),(0,a.iD)("div",he,(0,g.zw)(e.unread),1)):(0,a.kq)("",!0)]),(0,a._)("div",{class:"scroll-item_info",onClick:t=>n.navigateToChat(e)},[(0,a._)("div",ge,[(0,a._)("span",pe,(0,g.zw)(e.data.name),1)]),(0,a._)("div",ye,[(0,a._)("div",ve,[(0,a._)("div",we,["text"==e.lastMessage.type?((0,a.wg)(),(0,a.iD)("span",fe,(0,g.zw)(e.lastMessage.payload.text),1)):"video"==e.lastMessage.type?((0,a.wg)(),(0,a.iD)("span",_e,"[Video Message]")):"audio"==e.lastMessage.type?((0,a.wg)(),(0,a.iD)("span",Me,"[Audio Message]")):"image"==e.lastMessage.type?((0,a.wg)(),(0,a.iD)("span",Se,"[Image Message]")):"file"==e.lastMessage.type?((0,a.wg)(),(0,a.iD)("span",ke,"[File Message]")):"order"==e.lastMessage.type?((0,a.wg)(),(0,a.iD)("span",Ce,"[Order Message]")):((0,a.wg)(),(0,a.iD)("span",Ie,"[Unidentified content]"))]),(0,a._)("div",be,[(0,a.Wm)(p,{visible:i.activeActionKey===t,placement:"right",width:150,trigger:"click"},{reference:(0,a.w5)((()=>[(0,a.Wm)(u,{onClick:s=>n.showAction(e,t)},{default:(0,a.w5)((()=>[(0,a.Wm)(d)])),_:2},1032,["onClick"])])),default:(0,a.w5)((()=>[i.action.show?((0,a.wg)(),(0,a.iD)("div",De,[(0,a._)("div",null,[(0,a.Wm)(h,{type:"primary",onClick:n.topConversation},{default:(0,a.w5)((()=>[(0,a.Uk)((0,g.zw)(i.action.conversation.top?"Unpin":"Pin chat to the top"),1)])),_:2},1032,["onClick"])]),(0,a._)("div",Ee,[(0,a.Wm)(h,{type:"warning",onClick:n.removeConversation},{default:(0,a.w5)((()=>[Fe])),_:1},8,["onClick"])])])):(0,a.kq)("",!0)])),_:2},1032,["visible"])])])])],8,me)],2)))),128))])):((0,a.wg)(),(0,a.iD)("div",xe," No Chat Currently "))])),_:1}),(0,a.wy)((0,a._)("div",je,null,512),[[_.F8,i.showLoading]])])]),(0,a._)("div",Pe,[(0,a._)("div",Te,[(0,a.Wm)(y,{class:"scroll-view",ref:"scrollView"},{default:(0,a.w5)((()=>[(0,a._)("div",{class:"history-load-tip",onClick:t[0]||(t[0]=e=>n.loadMoreHistoryMessage())},(0,g.zw)(i.allHistoryLoaded?"History has no more messages":"Click to get history messages"),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.messages,((t,s)=>((0,a.wg)(),(0,a.iD)("div",{key:s},[0==s||o.messages[s].timestamp-o.messages[s-1].timestamp>3e5?((0,a.wg)(),(0,a.iD)("div",Ae,(0,g.zw)(e.formatDate(t.timestamp)),1)):(0,a.kq)("",!0),(0,a.Wm)(v,{message:t,messageStatus:t.status,to:i.friend,currentUser:o.currentUser,type:i.type,onShowImageFullScreen:n.showImageFullScreen},null,8,["message","messageStatus","to","currentUser","type","onShowImageFullScreen"])])))),128))])),_:1},512)]),(0,a.Wm)(w,{to:i.friend,type:i.type,onOnSent:n.messageOnSent},null,8,["to","type","onOnSent"]),(0,a.wy)((0,a._)("div",{class:"img-layer",onClick:t[1]||(t[1]=e=>i.image.show=!1)},[(0,a.Wm)(c,{src:i.image.url},null,8,["src"])],512),[[_.F8,i.image.show]])])])])])])])}var Ue=s(5323),qe=s(2931),We=s(6949),Le=s.p+"img/chat-icon.6be646e3.png",Ke=s.p+"img/chat-icon-1.17838274.png",Re=s(3907),Ve={name:"index",components:{meSideMenu:J.Z,SendBox:m,ChatMessage:Y},setup(){const e=(0,qe.iH)(localStorage.getItem("identity")),t=(0,a.Fl)((()=>e.value)),s=(0,Re.oR)();let o=localStorage.getItem("token");const i=(0,a.Fl)((()=>s.state.currentUser)),n=(0,a.Fl)((()=>s.state.nowChatUserInfo)),l=(0,a.Fl)((()=>s.state.showChatStatus)),r=()=>s.commit("showChatStatus",!s.state.showChatStatus),c=(0,qe.iH)([]);return{identity1:t,token:o,currentUser:i,nowChatUserInfo:n,showChatStatus:l,setShowChatStatus:r,messages:c}},watch:{},computed:{},data(){return{defaultAvatar:Ue,imgLogo:We,chatIcon:Le,chatIcon1:Ke,showLoading:!1,action:{conversation:null,show:!1,toastMessage:"",showToast:!1},conversationsData:[],activeConversationKey:void 0,friendId:void 0,chatType:"",friend:null,allHistoryLoaded:!1,image:{show:!1,url:""},type:"",unreadTotal:0,showBottomActionStatus:!1,activeActionKey:void 0}},beforeMount(){let e=this;this.showLoading=!0;let t=this.currentUser;"disconnected"===this.goEasy.getConnectionStatus()&&this.service.connect(t),this.goEasy.im.latestConversations({onSuccess:function(t){let s=t.content;e.showLoading=!1,e.unreadTotal=s.unreadTotal,e.conversationsData=s.conversations},onFailed:function(e){this.showLoading=!1,console.log("失败获取最新会话列表, code:"+e.code+" content:"+e.content)}}),this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,(t=>{e.conversationsData=t.conversations||[],e.unreadTotal=t.unreadTotal}));let s=e.nowChatUserInfo;"{}"!==JSON.stringify(s)&&(e.messages=e.service.getPrivateMessages(s.uuid),e.friend=s,e.activeConversationKey=s.uuid+"_"+s.identity,e.scrollToBottom(),e.initialPrivateListeners(),0!==e.messages.length&&e.markMessageAsRead(s.uuid))},unmounted(){this.service.onNewPrivateMessageReceive=function(){}},methods:{topConversation(){let e=this,t=this.action.conversation,s=t.top?"Cancel Failed":"Pin Failed";t.type===this.GoEasy.IM_SCENE.PRIVATE?this.goEasy.im.topPrivateConversation({userId:t.userId,top:!t.top,onSuccess:function(){console.log("pin success")},onFailed:function(t){e.$message.error(s),console.log(t)}}):this.goEasy.im.topGroupConversation({groupId:t.groupId,top:!t.top,onSuccess:function(){console.log("pin fail")},onFailed:function(t){e.$message.error(s),console.log(t)}}),this.action.show=!1,e.activeActionKey=void 0},removeConversation(){let e=this,t=this.action.conversation,s="delete failed";t.type===this.GoEasy.IM_SCENE.PRIVATE?this.goEasy.im.removePrivateConversation({userId:t.userId,onSuccess:function(){console.log("delete success")},onFailed:function(t){e.$message.error(s),console.log(t)}}):this.goEasy.im.removeGroupConversation({groupId:t.groupId,onSuccess:function(){console.log("delete failed")},onFailed:function(t){e.$message.error(s),console.log(t)}}),this.action.show=!1,e.activeActionKey=void 0},async navigateToChat(e){console.log("navigate to chat --------------------"),this.activeConversationKey=e.userId+"_"+e.data.identity;let t=e.userId||e.groupId,s=e.data.identity,a=t;this.type=this.GoEasy.IM_SCENE.PRIVATE,this.friend=await this.service.findFriendById(a,s),this.messages=this.service.getPrivateMessages(a),this.scrollToBottom(),this.initialPrivateListeners(),0!==this.messages.length&&this.markMessageAsRead(a)},showAction(e,t){this.activeActionKey===t?this.activeActionKey=void 0:this.activeActionKey=t,this.action.conversation=e,this.action.show=!0},initialPrivateListeners(){let e=this;this.service.onNewPrivateMessageReceive=(t,s)=>{console.log("传入监听器，收到一条私聊消息总是滚到到页面底部"+s);let a=this.messages;this.messages=[],this.messages=a,t===e.friend.uuid&&(e.markMessageAsRead(t),e.scrollToBottom())}},loadMoreHistoryMessage(){console.log("加载更多历史消息-----------------");let e=this,t=Date.now(),s=this.messages[0];s&&(t=s.timestamp);let a=this.messages.length;this.goEasy.im.history({userId:e.friend.uuid,lastTimestamp:t,onSuccess:function(t){let s=e.service.getPrivateMessages(e.friend.uuid),o=t.content;for(let e=o.length-1;e>=0;e--)s.unshift(o[e]);s.length===a&&(e.allHistoryLoaded=!0),e.messages=s},onFailed:function(e){401===e.code?console.log("获取历史消息失败,默认不开通，付费应用，可以在我的应用->查看详情，高级功能里自助开通"):console.log("获取历史消息失败, code:"+e.code+",错误信息:"+e.content)}})},markMessageAsRead(e){this.goEasy.im.markPrivateMessageAsRead({userId:e,onSuccess:function(){console.log("标记为已读成功")},onFailed:function(e){console.log("标记为已读失败",e)}})},showImageFullScreen(e){this.image.url=e.payload.url,this.image.show=!0},scrollToBottom(){this.$nextTick((()=>{this.$refs.scrollView.scrollTo(0,1e7)}))},messageOnSent(e){this.messages=[],this.messages=e,this.scrollToBottom(),this.$forceUpdate()}}};const ze=(0,u.Z)(Ve,[["render",$e],["__scopeId","data-v-7bf96b23"]]);var He=ze}}]);
//# sourceMappingURL=2431.da188f65.js.map